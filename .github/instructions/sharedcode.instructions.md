---
applyTo: "AIDevGallery/Samples/SharedCode/**/*.cs"
---

# SharedCode Instructions

When reviewing or modifying code in `AIDevGallery/Samples/SharedCode/`:

## Purpose

SharedCode contains reusable utilities that are:
1. Used by multiple samples within the app
2. **Exported** with samples when users generate standalone VS projects

Because SharedCode is exported, it has special requirements.

## Code Requirements

### Must Be Self-Contained
- Minimize dependencies on app-specific code
- Use only packages specified in sample's `NugetPackageReferences`
- Avoid references to `AIDevGallery.Pages`, `AIDevGallery.ViewModels`, etc.

### Must Be Exportable
- No internal app state dependencies
- No hardcoded paths to app resources
- Clear, documented public APIs

## SharedCodeEnum Auto-Generation

The `SharedCodeEnum` is auto-generated by the source generator from files in this directory:
- Each `.cs` file becomes an enum value
- XAML pairs (`.xaml` + `.xaml.cs`) get both `*Cs` and `*Xaml` values

Example: `BitmapFunctions.cs` → `SharedCodeEnum.BitmapFunctions`

## Usage in Samples

Reference in `[GallerySample]` attribute:
```csharp
[GallerySample(
    SharedCode = [
        SharedCodeEnum.BitmapFunctions,
        SharedCodeEnum.ImageNetLabels,
        SharedCodeEnum.Prediction
    ],
    NugetPackageReferences = [
        "System.Drawing.Common"
    ],
    ...
)]
```

## NuGet Package Mapping

When adding SharedCode that requires NuGet packages, samples using that code must include the packages:

| SharedCode | Required NuGet Packages |
|------------|------------------------|
| `BitmapFunctions` | `System.Drawing.Common` |
| `ImageNet`, `ImageNetLabels` | `System.Drawing.Common` |
| `WhisperWrapper` | `Microsoft.ML.OnnxRuntime.Extensions` |
| `EmbeddingGenerator` | `Microsoft.ML.OnnxRuntime.Extensions` |
| `StableDiffusionCode/*` | `Microsoft.ML.OnnxRuntime.Extensions` |

## Code Review Checks

- New SharedCode files follow naming conventions
- Required NuGet packages documented
- No app-specific dependencies
- Code compiles standalone (for export)
- Proper error handling for edge cases
- Comments explain non-obvious logic
- Matching `.xaml` files for any XAML controls

## File Structure

```
SharedCode/
├── BitmapFunctions.cs      # Image preprocessing utilities
├── ImageNet.cs             # ImageNet classification helpers
├── ImageNetLabels.cs       # ImageNet label mappings
├── Prediction.cs           # Prediction result structures
├── WhisperWrapper.cs       # Whisper speech-to-text wrapper
├── WinMLHelpers.cs         # WinML session creation helpers
├── Controls/               # Reusable XAML controls
│   ├── MyControl.xaml
│   └── MyControl.xaml.cs
├── Embeddings/             # Embedding generation utilities
├── IChatClient/            # Chat client abstractions
└── StableDiffusionCode/    # Stable Diffusion pipeline
```

## Adding New SharedCode

1. Create file in appropriate subfolder
2. Ensure file is self-contained
3. Rebuild to generate new `SharedCodeEnum` value
4. Update samples that use the code
5. Document required NuGet packages
