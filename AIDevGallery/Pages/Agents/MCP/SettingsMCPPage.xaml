<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="AIDevGallery.Pages.SettingsMCPPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" BorderThickness="1,0,0,0">
        <ScrollViewer>
            <StackPanel Margin="48,32,48,48" Spacing="24">
                <TextBlock
                    Style="{StaticResource TitleTextBlockStyle}"
                    Text="Settings MCP" />
                
                <TextBlock
                    Style="{StaticResource BodyTextBlockStyle}"
                    TextWrapping="Wrap">
                    This demo shows how to interact with the built-in Windows Settings MCP Server using the Model Context Protocol.
                    The Settings MCP Server provides tools to check, modify, and manage Windows settings programmatically.
                </TextBlock>

                <InfoBar
                    x:Name="PrerequisiteInfoBar"
                    IsOpen="True"
                    Severity="Informational"
                    Title="Prerequisites"
                    Message="This demo requires Windows MCP Private Preview 3 or later with odr.exe available. The Settings MCP Server must be enabled in Settings > System > AI Components." />

                <StackPanel Spacing="12">
                    <TextBlock
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Text="Connection Status" />
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button
                            x:Name="ConnectButton"
                            Content="Connect to Settings Server"
                            Click="ConnectButton_Click"
                            Style="{StaticResource AccentButtonStyle}" />
                        
                        <Button
                            x:Name="DisconnectButton"
                            Content="Disconnect"
                            Click="DisconnectButton_Click"
                            IsEnabled="False" />
                        
                        <ProgressRing
                            x:Name="ConnectionProgressRing"
                            Width="20"
                            Height="20"
                            IsActive="False" />
                        
                        <TextBlock
                            x:Name="ConnectionStatusText"
                            VerticalAlignment="Center"
                            Text="Not connected" />
                    </StackPanel>
                </StackPanel>

                <Grid x:Name="ToolsPanel" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="400" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Spacing="12">
                        <TextBlock
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Available Tools" />
                        
                        <TextBlock
                            Style="{StaticResource CaptionTextBlockStyle}"
                            TextWrapping="Wrap"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                            Select a tool below and provide the required input to execute it.
                        </TextBlock>
                        
                        <ScrollViewer MaxHeight="600" VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="ToolsList" />
                        </ScrollViewer>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Spacing="12" Margin="24,0,0,0">
                        <!-- Input Panel -->
                        <StackPanel x:Name="InputPanel" Spacing="12" Visibility="Collapsed">
                            <TextBlock
                                Style="{StaticResource SubtitleTextBlockStyle}"
                                Text="Input" />
                            
                            <!-- Settings Change Request Input -->
                            <StackPanel x:Name="SettingsChangeRequestPanel" Spacing="8" Visibility="Collapsed">
                                <TextBlock
                                    Style="{StaticResource BodyStrongTextBlockStyle}"
                                    Text="Settings Change Request:" />
                                <TextBlock
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    TextWrapping="Wrap"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Text="Enter the settings change you want to make. Examples: 'change to dark theme', 'enable night light'." />
                                <TextBox
                                    x:Name="SettingsChangeRequestTextBox"
                                    PlaceholderText="e.g., change to light theme"
                                    MinHeight="40"
                                    TextWrapping="Wrap" />
                            </StackPanel>

                            <!-- Undo ID Input -->
                            <StackPanel x:Name="UndoIdPanel" Spacing="8" Visibility="Collapsed">
                                <TextBlock
                                    Style="{StaticResource BodyStrongTextBlockStyle}"
                                    Text="Undo ID:" />
                                <TextBlock
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    TextWrapping="Wrap"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Text="Enter the Undo ID from a previous settings change to revert it. You can find the Undo ID in the results of a successful make_settings_change call." />
                                <TextBox
                                    x:Name="UndoIdTextBox"
                                    PlaceholderText="e.g., 52abfaa0-c310-472c-9aa4-4d9283056589"
                                    MinHeight="40"
                                    FontFamily="Consolas" />
                            </StackPanel>

                            <Button
                                x:Name="ExecuteToolButton"
                                Content="Execute Tool"
                                Click="ExecuteToolButton_Click"
                                Style="{StaticResource AccentButtonStyle}"
                                IsEnabled="False" />
                        </StackPanel>

                        <!-- Results Panel -->
                        <StackPanel x:Name="ResultPanel" Spacing="12" Visibility="Collapsed">
                            <TextBlock
                                Style="{StaticResource SubtitleTextBlockStyle}"
                                Text="Results" />
                            
                            <Border
                                Background="{ThemeResource LayerFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16">
                                <ScrollViewer MaxHeight="600">
                                    <TextBlock
                                        x:Name="ResultTextBlock"
                                        FontFamily="Consolas"
                                        IsTextSelectionEnabled="True"
                                        TextWrapping="Wrap" />
                                </ScrollViewer>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <StackPanel x:Name="ErrorPanel" Spacing="12" Visibility="Collapsed">
                    <InfoBar
                        x:Name="ErrorInfoBar"
                        Severity="Error"
                        IsOpen="True"
                        Title="Error" />
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
