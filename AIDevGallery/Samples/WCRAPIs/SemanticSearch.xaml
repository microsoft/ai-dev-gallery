<?xml version="1.0" encoding="utf-8" ?>
<samples:BaseSamplePage
    x:Class="AIDevGallery.Samples.WCRAPIs.SemanticSearch"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shared="using:AIDevGallery.Samples.SharedCode"
    xmlns:samples="using:AIDevGallery.Samples"
    mc:Ignorable="d">
    <Grid BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
          BorderThickness="0,0,0,1"
          Margin="-20"
          Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition x:Name="SidePanelRow" Height="0" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition x:Name="SidePanelColumn" Width="0.4*" MinWidth="200" />
        </Grid.ColumnDefinitions>
        <StackPanel Spacing="8">
            <TextBlock 
                Style="{StaticResource CaptionTextBlockStyle}" 
                Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                Text="Sample text data:"/>
            <Button
                x:Name="uploadTextButton"
                Grid.Column="1"
                Margin="3,0,0,0"
                Click="AddTextDataButton_Click">
                <StackPanel Orientation="Horizontal">
                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE898;" FontSize="16" Margin="0,0,4,0"/>
                    <TextBlock Text="Add Text Data"/>
                </StackPanel>
            </Button>
            <ItemsView
                x:Name="textDataItemsView"
                ItemsSource="{x:Bind TextDataItems}"
                SelectionMode="None"
                IsItemInvokedEnabled="False"
                Grid.Column="0"
                Padding="0,0,0,12">
                <ItemsView.ItemTemplate>
                    <DataTemplate x:DataType="shared:TextDataItem">
                        <ItemContainer AutomationProperties.Name="{x:Bind Id}" Width="200" Margin="3" IsTabStop="False">
                            <Grid>
                                <TextBox Text="{x:Bind Value, Mode=TwoWay}"
                                        Tag="{x:Bind Id}"
                                        TextChanged="SemanticTextBox_TextChanged"
                                        AcceptsReturn="True"
                                        TextWrapping="Wrap"
                                        Padding="11,32,11,11"
                                        Height="120"/>
                                <Button
                                    x:Name="textCloseButton"
                                    Click="CloseButton_Click"
                                    Tag="{x:Bind}"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="0,4,4,0"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Style="{StaticResource SubtleButtonStyle}">
                                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE711;" FontSize="16"/>
                                </Button>

                                <TextBlock Text="{x:Bind Id}" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="12,7" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            </Grid>
                        </ItemContainer>
                    </DataTemplate>
                </ItemsView.ItemTemplate>
                <ItemsView.Layout>
                    <StackLayout Orientation="Horizontal" />
                </ItemsView.Layout>
            </ItemsView>

            <TextBlock Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="Sample image data:" />
            
            <Button
                x:Name="uploadImageButton"
                Grid.Column="1"
                VerticalAlignment="Top"
                Margin="3,0,0,0"
                Click="UploadImageButton_Click">
                <StackPanel Orientation="Horizontal">
                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE898;" FontSize="16" Margin="0,0,4,0"/>
                    <TextBlock Text="Add Image Data"/>
                </StackPanel>
            </Button>
            <ItemsView
                x:Name="ImageDataItemsView"
                ItemsSource="{x:Bind ImageDataItems}"
                SelectionMode="None"
                IsItemInvokedEnabled="False"
                Grid.Column="0">
                <ItemsView.ItemTemplate>
                    <DataTemplate x:DataType="shared:ImageDataItem">
                        <ItemContainer AutomationProperties.Name="{x:Bind Id}" Width="200" Height="200" Margin="3">
                            <Grid>
                                <Image Source="{x:Bind ImageSource}"
                                        Tag="{x:Bind Id}"
                                        ImageOpened="ImageData_ImageOpened" 
                                        Stretch="UniformToFill" 
                                        HorizontalAlignment="Stretch" 
                                        VerticalAlignment="Stretch" 
                                        MinWidth="70"/>
                                <Border Background="{ThemeResource LayerFillColorAltBrush}" Height="34" VerticalAlignment="Top" />
                                <Button
                                    x:Name="imageCloseButton"
                                    Click="CloseButton_Click"
                                    Tag="{x:Bind}"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="0,4,4,0"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Style="{StaticResource SubtleButtonStyle}">
                                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE711;" FontSize="16"/>
                                </Button>

                                <TextBlock Text="{x:Bind Id}" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="12,7" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            </Grid>
                        </ItemContainer>
                    </DataTemplate>
                </ItemsView.ItemTemplate>
                <ItemsView.Layout>
                    <StackLayout Orientation="Horizontal" />
                </ItemsView.Layout>
            </ItemsView>
        </StackPanel>

        <Grid x:Name="SidePanel"
            Grid.Row="0"
            Grid.Column="1" 
            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1,1,1,0"
            Margin="0,-20,-20,-20"
            Padding="20">

            <StackPanel>
                <TextBlock 
                    Style="{StaticResource CaptionTextBlockStyle}" 
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                    Text="Search sample data:"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <AutoSuggestBox x:Name="SearchBox"
                         AutomationProperties.Name="Prompt input"
                         PlaceholderText="e.g., Meal preparation"
                         QueryIcon="Find"
                         QuerySubmitted="SearchBox_QuerySubmitted"
                         Margin="0,7"/>
                    <Button Style="{StaticResource SubtleButtonStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Grid.Column="1" Margin="3,0">
                        <Button.Content>
                            <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE713;" FontSize="14"/>
                        </Button.Content>
                        <Button.Flyout>
                            <Flyout>
                                <StackPanel>
                                    <!-- Query Options -->
                                    <TextBlock Text="Query Options:" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,0,12"/>
                                    <TextBox x:Name="QueryLanguageTextBox" Header="Query Language" PlaceholderText="e.g., en-US"/>

                                    <!--Text Match Options-->
                                    <TextBlock Text="Text Match Options:" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,18,0,12"/>
                                    <ComboBox x:Name="TextMatchScopeComboBox" Header="Match Scope" HorizontalAlignment="Stretch" SelectedIndex="0" Margin="0,0,0,12">
                                        <ComboBoxItem Content="Unconstrained"/>
                                        <ComboBoxItem Content="Region"/>
                                        <ComboBoxItem Content="ContentItem"/>
                                    </ComboBox>
                                    <ComboBox x:Name="TextMatchTypeComboBox" Header="Match Type" HorizontalAlignment="Stretch" SelectedIndex="0">
                                        <ComboBoxItem Content="Fuzzy"/>
                                        <ComboBoxItem Content="Exact"/>
                                    </ComboBox>

                                    <!--Image Match Options-->
                                    <TextBlock Text="Image Match Options" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,18,0,12"/>
                                    <ComboBox x:Name="ImageMatchScopeComboBox" Header="Match Scope" HorizontalAlignment="Stretch" SelectedIndex="0" Margin="0,0,0,12">
                                        <ComboBoxItem Content="Unconstrained"/>
                                        <ComboBoxItem Content="Region"/>
                                        <ComboBoxItem Content="ContentItem"/>
                                    </ComboBox>
                                    <ComboBox x:Name="ImageOcrTextMatchTypeComboBox" Header="OCR Match Type" HorizontalAlignment="Stretch" SelectedIndex="0">
                                        <ComboBoxItem Content="Fuzzy"/>
                                        <ComboBoxItem Content="Exact"/>
                                    </ComboBox>

                                    <Button Content="Index All Manually" Click="IndexAllButton_Click" Margin="0,24"/>

                                    <TextBlock x:Name="AllIndexAvailableTextBlock" Text="All index capabilities are available." Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                </Grid>

                <Grid
                    x:Name="ResultsGrid"
                    Grid.Column="1"
                    MaxHeight="415"
                    Visibility="Collapsed">

                    <StackPanel>
                        <TextBlock x:Name="ResultStatusTextBlock" Style="{ThemeResource BodyStrongTextBlockStyle}" Margin="0,12" />
                        <ScrollViewer
                            MaxHeight="350"
                            HorizontalScrollBarVisibility="Disabled"
                            VerticalScrollBarVisibility="Visible">
                            <StackPanel Padding="0,0,0,48">
                                <TextBlock
                                     x:Name="ResultsTextBlock"
                                     Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                     IsTextSelectionEnabled="True"
                                     TextWrapping="WrapWholeWords" />
                                <ItemsView x:Name="ImageResultsBox" Grid.Row="2" Visibility="Collapsed">
                                    <ItemsView.Layout>
                                        <LinedFlowLayout />
                                    </ItemsView.Layout>
                                    <ItemsView.ItemTemplate>
                                        <DataTemplate>
                                            <ItemContainer MaxWidth="150" Margin="4">
                                                <Image Source="{Binding}" Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </ItemContainer>
                                        </DataTemplate>
                                    </ItemsView.ItemTemplate>
                                </ItemsView>
                            </StackPanel>
                            
                           
                        </ScrollViewer>
                        
                    </StackPanel>
                </Grid>
            </StackPanel>

            <Grid HorizontalAlignment="Stretch" VerticalAlignment="Bottom">
                <StackPanel Spacing="7">
                    <InfoBar
                        x:Name="IndexingMessage"
                        IsOpen="False"
                        Severity="Informational"
                        Title="Indexing"
                        Message="Partial results may be available." 
                        Padding="0"/>
                    <InfoBar
                        x:Name="RemovedItemMessage"
                        IsOpen="False"
                        Severity="Informational"
                        Message="Item has been removed" 
                        Padding="0"/>
                    <InfoBar x:Name="IndexCapabilitiesMessage"
                             IsOpen="False"
                             Severity="Warning"
                             IsClosable="False"
                             Title="Some index capabilities are unavailable."
                             Padding="0">
                        <InfoBar.ActionButton>
                            <HyperlinkButton Content="Windows AI Troubleshooting"
                                             NavigateUri="https://learn.microsoft.com/en-us/windows/ai/apis/troubleshooting"/>
                        </InfoBar.ActionButton>
                    </InfoBar>
                </StackPanel>
            </Grid>
        </Grid>
        
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="LayoutVisualStates">
                <VisualState x:Name="WideLayout">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="800" />
                    </VisualState.StateTriggers>
                </VisualState>
                <VisualState x:Name="NarrowLayout">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="SidePanel.(Grid.Column)" Value="0" />
                        <Setter Target="SidePanel.(Grid.Row)" Value="1" />
                        <Setter Target="SidePanel.Margin" Value="-20,20,-20,-20" />
                        <Setter Target="SidePanelColumn.Width" Value="0" />
                        <Setter Target="SidePanelColumn.MinWidth" Value="0" />
                        <Setter Target="SidePanelColumn.Height" Value="300" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>

</samples:BaseSamplePage>
